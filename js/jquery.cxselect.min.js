/*!
 * jQuery cxSelect
 * @name jquery.cxselect.js
 * @version 1.3.11
 * @date 2016-03-23
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxSelect
 * @license Released under the MIT license
 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(window.jQuery||window.Zepto||window.$)}(function(a){a.cxSelect=function(){var b={dom:{}};return b.init=function(){var c,g,h,i,j,b=this,d=function(a){return a&&("function"==typeof HTMLElement||"object"==typeof HTMLElement)&&a instanceof HTMLElement?!0:a&&a.nodeType&&1===a.nodeType?!0:!1},e=function(a){return a&&a.length&&("function"==typeof jQuery||"object"==typeof jQuery)&&a instanceof jQuery?!0:!1},f=function(a){return a&&a.length&&("function"==typeof Zepto||"object"==typeof Zepto)&&Zepto.zepto.isZ(a)?!0:!1};for(g=0,h=arguments.length;h>g;g++)e(arguments[g])||f(arguments[g])?b.dom.box=arguments[g]:d(arguments[g])?b.dom.box=a(arguments[g]):"object"==typeof arguments[g]&&(c=arguments[g]);if(b.dom.box.length&&(b.settings=a.extend({},a.cxSelect.defaults,c,{url:b.dom.box.data("url"),nodata:b.dom.box.data("nodata"),required:b.dom.box.data("required"),firstTitle:b.dom.box.data("firstTitle"),firstValue:b.dom.box.data("firstValue"),jsonSpace:b.dom.box.data("jsonSpace"),jsonName:b.dom.box.data("jsonName"),jsonValue:b.dom.box.data("jsonValue"),jsonSub:b.dom.box.data("jsonSub")}),i=b.dom.box.data("selects"),"string"==typeof i&&i.length&&(b.settings.selects=i.split(",")),a.isArray(b.settings.selects)&&b.settings.selects.length)){for(b.selectArray=[],g=0,h=b.settings.selects.length;h>g&&(j=b.dom.box.find("select."+b.settings.selects[g]),j&&j.length);g++)"undefined"==typeof j.data("value")&&j[0].options.length&&"string"==typeof j.val()&&j.attr("data-value",j.val()),b.selectArray.push(j);b.selectArray.length&&(b.dom.box.on("change","select",function(){b.selectChange(this.className)}),b.settings.url?"string"==typeof b.settings.url&&b.settings.url.length?a.getJSON(b.settings.url,function(a){b.start(a)}):"object"==typeof b.settings.url&&b.start(b.settings.url):b.start())}},b.getIndex=function(a,b){return b?a:a-1},b.start=function(a){var d,e,f,b=this,c=b.settings.jsonSpace;if(b.dataJson=void 0,a&&"object"==typeof a&&(b.dataJson=a,"string"==typeof c&&c.length))for(d=c.split("."),e=0,f=d.length;f>e;e++)b.dataJson=b.dataJson[d[e]];b.dataJson||"string"==typeof b.selectArray[0].data("url")&&b.selectArray[0].data("url").length?b.getOptionData(0):b.selectArray[0].prop("disabled",!1).css({display:"",visibility:""})},b.selectChange=function(a){var b,c,d,e;if("string"==typeof a&&a.length){for(b=this,a=a.replace(/\s+/g,","),a=","+a+",",d=0,e=b.selectArray.length;e>d;d++)if(a.indexOf(","+b.settings.selects[d]+",")>-1){c=d;break}"number"==typeof c&&c>-1&&(c+=1,b.getOptionData(c))}},b.getOptionData=function(b){var e,f,g,h,i,j,k,l,m,n,o,d=this;if(!("number"!=typeof b||isNaN(b)||0>b||b>=d.selectArray.length)){for(e=b-1,f=d.selectArray[b],i=f.data("url"),j="undefined"==typeof f.data("jsonSpace")?d.settings.jsonSpace:f.data("jsonSpace"),k={},n=b,o=d.selectArray.length;o>n;n++)d.selectArray[n].empty().prop("disabled",!0),"none"===d.settings.nodata?d.selectArray[n].css("display","none"):"hidden"===d.settings.nodata&&d.selectArray[n].css("visibility","hidden");if("string"==typeof i&&i.length){if(e>=0){if(!d.selectArray[e].val().length)return;l=f.data("queryName"),m=d.selectArray[e].attr("name"),"string"==typeof l&&l.length?k[l]=d.selectArray[e].val():"string"==typeof m&&m.length&&(k[m]=d.selectArray[e].val())}a.getJSON(i,k,function(a){var b,c,e;if(g=a,"string"==typeof j&&j.length)for(b=j.split("."),c=0,e=b.length;e>c;c++)g=g[b[c]];d.buildOption(f,g)})}else if(d.dataJson&&"object"==typeof d.dataJson){for(g=d.dataJson,n=0;b>n;n++){if(h=d.getIndex(d.selectArray[n][0].selectedIndex,"boolean"==typeof d.selectArray[n].data("required")?d.selectArray[n].data("required"):d.settings.required),"object"!=typeof g[h]||!a.isArray(g[h][d.settings.jsonSub])||!g[h][d.settings.jsonSub].length){g=null;break}g=g[h][d.settings.jsonSub]}d.buildOption(f,g)}}},b.buildOption=function(b,c){var j,k,l,d=this,e="boolean"==typeof b.data("required")?b.data("required"):d.settings.required,f="undefined"==typeof b.data("firstTitle")?d.settings.firstTitle:b.data("firstTitle"),g="undefined"==typeof b.data("firstValue")?d.settings.firstValue:b.data("firstValue"),h="undefined"==typeof b.data("jsonName")?d.settings.jsonName:b.data("jsonName"),i="undefined"==typeof b.data("jsonValue")?d.settings.jsonValue:b.data("jsonValue");if(a.isArray(c)){if(j=e?"":'<option value="'+String(g)+'">'+String(f)+"</option>","string"==typeof h&&h.length)for("string"==typeof i&&i.length||(i=h),k=0,l=c.length;l>k;k++)j+='<option value="'+String(c[k][i])+'">'+String(c[k][h])+"</option>";else for(k=0,l=c.length;l>k;k++)j+='<option value="'+String(c[k])+'">'+String(c[k])+"</option>";b.html(j).prop("disabled",!1).css({display:"",visibility:""}),"string"==typeof b.attr("data-value")&&(b.val(String(b.attr("data-value"))).removeAttr("data-value"),b[0].selectedIndex<0&&(b[0].options[0].selected=!0)),b.trigger("change")}},b.init.apply(b,arguments),this},a.cxSelect.defaults={selects:[],url:null,nodata:null,required:!1,firstTitle:"请选择",firstValue:"",jsonSpace:"",jsonName:"n",jsonValue:"",jsonSub:"s"},a.fn.cxSelect=function(b,c){return this.each(function(){a.cxSelect(this,b,c)}),this}});